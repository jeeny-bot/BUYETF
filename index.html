<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SKH4HQJCG4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SKH4HQJCG4');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BUYETF | SMART ETF INVESTING</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: 'class' }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Pretendard', sans-serif; transition: background-color 0.1s ease, color 0.1s ease; }
      .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
      input[type="range"] { -webkit-appearance: none; background: rgba(0,0,0,0.05); border-radius: 99px; height: 6px; outline: none; }
      input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #1e293b; cursor: pointer; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: transform 0.1s ease; }
      input[type="range"]::-webkit-slider-thumb:active { transform: scale(1.3); }
      .dark input[type="range"]::-webkit-slider-thumb { background: #f8fafc; border-color: #0f172a; }
      .modal-overlay { backdrop-filter: blur(8px); transition: all 0.3s ease; }
      
      /* ìŠ¤ì¼ˆë ˆí†¤ ì• ë‹ˆë©”ì´ì…˜ */
      @keyframes shimmer {
        0% { background-position: -1000px 0; }
        100% { background-position: 1000px 0; }
      }
      .skeleton {
        animation: shimmer 2s infinite linear;
        background: linear-gradient(to right, #f0f0f0 4%, #e0e0e0 25%, #f0f0f0 36%);
        background-size: 1000px 100%;
      }
      .dark .skeleton {
        background: linear-gradient(to right, #334155 4%, #475569 25%, #334155 36%);
        background-size: 1000px 100%;
      }

      /* ì•Œë¦¼ í† ìŠ¤íŠ¸ */
      @keyframes slideIn {
        from { transform: translateX(400px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(400px); opacity: 0; }
      }
      .toast-enter { animation: slideIn 0.3s ease-out; }
      .toast-exit { animation: slideOut 0.3s ease-in; }
    </style>
</head>
<body class="bg-[#F8FAFC] text-slate-900 dark:bg-slate-950 dark:text-slate-100">

<!-- ì•Œë¦¼ í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
<div id="toastContainer" class="fixed top-24 right-6 z-[300] flex flex-col gap-3 pointer-events-none"></div>

<div class="fixed top-6 right-6 z-[100] flex gap-3">
  <button onclick="toggleLanguage()" id="langBtn" class="flex items-center gap-2 px-4 py-2 rounded-full bg-white dark:bg-slate-800 shadow-lg border border-slate-200 dark:border-slate-700 font-bold text-sm hover:scale-105 transition-transform">ğŸŒ ENG</button>
  <button onclick="toggleDarkMode()" class="flex items-center gap-2 px-4 py-2 rounded-full bg-white dark:bg-slate-800 shadow-lg border border-slate-200 dark:border-slate-700 text-sm hover:scale-105 transition-transform">
    <span class="dark:hidden">ğŸŒ™ Dark</span>
    <span class="hidden dark:inline">â˜€ï¸ Light</span>
  </button>
</div>

<section class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 py-24">
  <div class="max-w-5xl mx-auto px-6 text-center">
    <div class="flex justify-center mb-8">
      <span class="inline-flex items-center gap-3 px-6 py-2.5 text-lg font-black tracking-tighter uppercase rounded-full border-2 border-blue-600/10 bg-blue-50/30 dark:bg-blue-900/20">
        <span class="text-blue-600 dark:text-blue-400">BUYETF</span>
        <span class="text-slate-400">|</span>
        <span class="text-slate-600 dark:text-slate-300 font-bold text-sm" data-i18n="subHeader">ìŠ¤ë§ˆíŠ¸ ì¸ë² ìŠ¤íŠ¸ë¨¼íŠ¸</span>
      </span>
    </div>
    <h1 class="text-4xl font-black tracking-tighter mb-8 leading-tight">
      <span data-i18n="titleMain">ë°ì´í„°ë¡œ ì„¤ê³„í•˜ëŠ”</span> <span class="text-blue-600 dark:text-blue-400" data-i18n="titlePoint">ETF í¬íŠ¸í´ë¦¬ì˜¤</span>
    </h1>
    <p class="text-xl text-slate-500 dark:text-slate-400 font-medium" data-i18n="description">ìµœì í™”ëœ ë°°ë‹¹ê³¼ ì„±ì¥ì˜ ë¹„ìœ¨ì„ ì œì•ˆí•©ë‹ˆë‹¤.</p>
  </div>
</section>

<section class="py-24 -mt-12 relative z-10">
  <div class="max-w-7xl mx-auto px-6">
    <div class="grid md:grid-cols-3 gap-10 text-center">

      <!-- í˜„ê¸ˆíë¦„í˜• -->
      <button
        onclick="selectProfile('í˜„ê¸ˆíë¦„í˜•')"
        class="group card-hover bg-white dark:bg-slate-900 p-8 rounded-[2.5rem]
               border-2 border-emerald-100 dark:border-emerald-900/30
               transition-all text-left flex flex-col justify-between min-h-[150px]
               shadow-sm hover:border-emerald-400
               focus-visible:ring-4 focus-visible:ring-emerald-400/30 focus-visible:outline-none">

        <div>
          <div class="flex items-center gap-3 mb-6">
            <div class="w-16 h-16 bg-emerald-500 rounded-[1.25rem]
                        flex items-center justify-center text-2xl
                        shadow-lg group-hover:scale-110 transition-transform">
              ğŸ’°
            </div>
            <span class="text-2xl font-bold text-emerald-900 dark:text-emerald-400">
              í˜„ê¸ˆíë¦„í˜•
            </span>
          </div>

          <p class="text-base text-slate-500 dark:text-slate-400 leading-relaxed font-medium"
             data-i18n="type1Desc">
            ì•ˆì •ì ì¸ ë°°ë‹¹ê¸ˆìœ¼ë¡œ 
            ìƒí™œì„ ì„¤ê³„í•©ë‹ˆë‹¤.
          </p>
        </div>

        <div class="mt-6 flex items-center text-emerald-600 font-bold italic"
             data-i18n="selectBtn">
          ì „ëµ ì„ íƒí•˜ê¸° â†’
        </div>
      </button>

      <!-- ì„±ì¥í˜• -->
      <button
        onclick="selectProfile('ì„±ì¥í˜•')"
        class="group card-hover bg-white dark:bg-slate-900 p-8 rounded-[2.5rem]
               border-2 border-blue-100 dark:border-blue-900/30
               transition-all text-left flex flex-col justify-between min-h-[150px]
               shadow-sm hover:border-blue-400
               focus-visible:ring-4 focus-visible:ring-blue-400/30 focus-visible:outline-none">

        <div>
          <div class="flex items-center gap-3 mb-6">
            <div class="w-16 h-16 bg-blue-500 rounded-[1.25rem]
                        flex items-center justify-center text-2xl
                        shadow-lg group-hover:scale-110 transition-transform">
              ğŸ“ˆ
            </div>
            <span class="text-2xl font-bold text-blue-900 dark:text-blue-400">
              ì„±ì¥í˜•
            </span>
          </div>

          <p class="text-base text-slate-500 dark:text-slate-400 leading-relaxed font-medium"
             data-i18n="type2Desc">
            ì‹œì¥ë³´ë‹¤ ë†’ì€ ìˆ˜ìµë¥ ì„ 
            ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
          </p>
        </div>

        <div class="mt-6 flex items-center text-blue-600 font-bold italic"
             data-i18n="selectBtn">
          ì „ëµ ì„ íƒí•˜ê¸° â†’
        </div>
      </button>

      <!-- í˜¼í•©í˜• -->
      <button
        onclick="selectProfile('í˜¼í•©í˜•')"
        class="group card-hover bg-white dark:bg-slate-900 p-8 rounded-[2.5rem]
               border-2 border-amber-100 dark:border-amber-900/30
               transition-all text-left flex flex-col justify-between min-h-[150px]
               shadow-sm hover:border-amber-400
               focus-visible:ring-4 focus-visible:ring-amber-400/30 focus-visible:outline-none">

        <div>
          <div class="flex items-center gap-3 mb-6">
            <div class="w-16 h-16 bg-amber-500 rounded-[1.25rem]
                        flex items-center justify-center text-2xl
                        shadow-lg group-hover:scale-110 transition-transform">
              âš–ï¸
            </div>
            <span class="text-2xl font-bold text-amber-900 dark:text-amber-400">
              í˜¼í•©í˜•
            </span>
          </div>

          <p class="text-base text-slate-500 dark:text-slate-400 leading-relaxed font-medium"
             data-i18n="type3Desc">
            ì„±ì¥ê³¼ ë°°ë‹¹ì˜ ë°¸ëŸ°ìŠ¤ë¥¼ 
            ì¶”êµ¬í•©ë‹ˆë‹¤.
          </p>
        </div>

        <div class="mt-6 flex items-center text-amber-600 font-bold italic"
             data-i18n="selectBtn">
          ì „ëµ ì„ íƒí•˜ê¸° â†’
        </div>
      </button>

    </div>
  </div>
</section>

<section id="portfolioSection" class="py-24 bg-slate-100 dark:bg-slate-800/50 hidden border-t border-slate-200 dark:border-slate-800">
  <div class="max-w-6xl mx-auto px-6">
    <div class="flex items-center justify-between mb-12">
      <div class="flex items-baseline gap-4">
        <h2 class="text-4xl font-black tracking-tighter" data-i18n="resultTitle">ë‚˜ì˜ ë§ì¶¤ í¬íŠ¸í´ë¦¬ì˜¤</h2>
        <div id="weightBadgeParent" class="px-4 py-1.5 rounded-xl bg-blue-600 text-white text-sm font-bold">
          Total: <span id="totalWeightDisplay">100</span>%
          <span id="liveStatus" class="ml-2 text-[10px] text-blue-200 animate-pulse hidden">LIVE SYNC...</span>
        </div>
      </div>
      
      <!-- í¬íŠ¸í´ë¦¬ì˜¤ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ -->
      <div class="flex gap-3">
        <button onclick="savePortfolio()" class="px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-bold transition-colors flex items-center gap-2">
          ğŸ’¾ <span data-i18n="saveBtn">ì €ì¥</span>
        </button>
        <button onclick="loadPortfolio()" class="px-4 py-2 rounded-xl bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold transition-colors flex items-center gap-2">
          ğŸ“‚ <span data-i18n="loadBtn">ë¶ˆëŸ¬ì˜¤ê¸°</span>
        </button>
      </div>
    </div>
    
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12" id="etfList"></div>

    <div class="grid lg:grid-cols-2 gap-8">
      <div class="bg-white dark:bg-slate-900 p-10 rounded-[2.5rem] shadow-sm border border-slate-200 dark:border-slate-800 text-center">
        <h3 class="text-xl font-bold mb-8 flex items-center justify-center">
          <span class="w-1.5 h-6 bg-blue-600 rounded-full mr-3"></span>
          <span data-i18n="chartTitle">í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘</span>
        </h3>
        <div class="max-w-[300px] mx-auto">
          <canvas id="portfolioChart"></canvas>
        </div>
      </div>

      <div class="bg-slate-900 dark:bg-black text-white p-10 rounded-[2.5rem] shadow-xl flex flex-col border border-slate-800">
        <div class="flex items-center gap-3 mb-6">
          <h3 class="text-xl text-slate-400 font-black uppercase tracking-wider" data-i18n="dividendLabel">ì˜ˆìƒ ì›” ë°°ë‹¹ê¸ˆ</h3>
          <div id="annualYieldBadge" class="hidden px-4 py-1.5 rounded-full bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 text-sm font-black">
            <span data-i18n="yield">ë°°ë‹¹ìˆ˜ìµë¥ </span> <span id="annualYieldValue">0</span>%
          </div>
        </div>
        
        <div id="monthlyDividendDisplay" class="mb-10">
          <p class="text-3xl font-black text-blue-400 tracking-tighter" id="valUSD">$0.00</p>
          <div class="inline-flex items-center gap-3 px-6 py-3 rounded-2xl bg-slate-800/60 border border-slate-700/50 mt-6">
            <span class="text-2xl text-slate-500 font-bold">â‰ˆ</span>
            <span class="text-3xl font-black text-slate-300" id="valKRW">â‚©0</span>
          </div>
          
          <!-- í™˜ìœ¨ ì •ë³´ í‘œì‹œ -->
          <div id="exchangeRateInfo" class="mt-4 text-xs text-slate-500 flex items-center justify-center gap-2">
            <span data-i18n="exchangeRate">í™˜ìœ¨</span>: <span id="exchangeRateValue">â‚©1,380</span>
            <span id="exchangeRateStatus" class="hidden">âœ“</span>
          </div>
        </div>
        
        <div class="space-y-6 border-t border-slate-800 pt-8 mt-auto">
          <div class="bg-slate-800/40 p-8 rounded-[2rem] border border-slate-500/50">
            <div class="mb-8">
              <label class="text-xl text-slate-400 font-black uppercase tracking-wider block mb-4" data-i18n="inputKrw">íˆ¬ì ì˜ˆì • ê¸ˆì•¡ (KRW)</label>
              <input type="text" id="totalInvestmentKRW" class="w-full bg-transparent border-none p-0 text-white font-black text-2xl focus:ring-0 outline-none" placeholder="0" oninput="handleCurrencyInput(this, 'KRW')">
            </div>
            <div class="border-t border-slate-800/30 my-8"></div>
            <div>
              <label class="text-xl text-slate-400 font-black uppercase tracking-wider block mb-4" data-i18n="inputUsd">íˆ¬ì ì˜ˆì • ê¸ˆì•¡ (USD)</label>
              <input type="text" id="totalInvestment" class="w-full bg-transparent border-none p-0 text-slate-400 font-black text-3xl focus:ring-0 outline-none" placeholder="0" oninput="handleCurrencyInput(this, 'USD')">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div id="detailModal" class="fixed inset-0 z-[200] flex items-center justify-center hidden">
  <div class="absolute inset-0 bg-slate-900/60 modal-overlay" onclick="closeModal()"></div>
  <div class="bg-white dark:bg-slate-900 w-full max-w-lg mx-6 p-10 rounded-[3rem] relative z-[210] shadow-2xl border border-slate-200 dark:border-slate-800 transform transition-all scale-95 opacity-0" id="modalContent">
    <div class="flex justify-between items-center mb-8">
      <div>
        <h3 id="modalTitle" class="text-4xl font-black tracking-tighter uppercase">ETF Info</h3>
        <p id="modalStatus" class="text-xs font-bold text-blue-500 mt-1 uppercase tracking-widest">Ready</p>
      </div>
      <button type="button" onclick="closeModal()" class="text-slate-400 hover:text-slate-900 dark:hover:text-white text-3xl p-2 focus:outline-none" aria-label="Close modal">âœ•</button>
    </div>
    
    <!-- ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© -->
    <div id="modalSkeleton" class="space-y-6 hidden">
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl">
        <div class="skeleton h-5 w-24 rounded"></div>
        <div class="skeleton h-6 w-16 rounded"></div>
      </div>
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl">
        <div class="skeleton h-5 w-32 rounded"></div>
        <div class="skeleton h-6 w-20 rounded"></div>
      </div>
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl">
        <div class="skeleton h-5 w-32 rounded"></div>
        <div class="skeleton h-6 w-20 rounded"></div>
      </div>
    </div>
    
    <!-- ì‹¤ì œ ì»¨í…ì¸  -->
    <div id="modalData" class="space-y-6">
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl border border-slate-100 dark:border-slate-700">
        <span class="font-bold text-slate-500" data-i18n="yield">ë°°ë‹¹ìˆ˜ìµë¥ </span>
        <span id="modalDiv" class="font-black text-blue-600 text-xl">-</span>
      </div>
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl border border-slate-100 dark:border-slate-700">
        <span class="font-bold text-slate-500" data-i18n="return1Y">ê³¼ê±° 1ë…„ ìˆ˜ìµë¥ </span>
        <span id="modal1Y" class="font-black text-emerald-500 text-xl">-</span>
      </div>
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl border border-slate-100 dark:border-slate-700">
        <span class="font-bold text-slate-500" data-i18n="return3Y">ê³¼ê±° 3ë…„ ìˆ˜ìµë¥ </span>
        <span id="modal3Y" class="font-black text-emerald-500 text-xl">-</span>
      </div>
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl border border-slate-100 dark:border-slate-700">
        <span class="font-bold text-slate-500" data-i18n="lastUpdate">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</span>
        <span id="modalLastUpdate" class="font-bold text-slate-600 dark:text-slate-400 text-sm">-</span>
      </div>
    </div>
  </div>
</div>

<script>
  // ==========================================
  // ì„¤ì • ë° ìƒìˆ˜
  // ==========================================
  
  // âš ï¸ ë³´ì•ˆ ê²½ê³ : API í‚¤ëŠ” ë°˜ë“œì‹œ ë°±ì—”ë“œë¡œ ì´ë™í•´ì•¼ í•©ë‹ˆë‹¤
  // í˜„ì¬ëŠ” ë°ëª¨ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©. í”„ë¡œë•ì…˜ì—ì„œëŠ” ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ ì‚¬ìš© ê¶Œì¥
  const API_CONFIG = {
    key: 'LjXZQ9T5YNoz7V1Riy47qTRTc8EnWe4T',
    baseUrl: 'https://financialmodelingprep.com/api/v3',
    cacheTimeout: 300000 // 5ë¶„
  };

  const chartColors = ['#2563eb', '#10b981', '#f59e0b', '#8b5cf6'];
  const cardLightColors = ['rgba(37, 99, 235, 0.08)', 'rgba(16, 185, 129, 0.08)', 'rgba(245, 158, 11, 0.08)', 'rgba(139, 92, 246, 0.08)'];

  const translations = {
    ko: { 
      lang: "ğŸŒ ENG", 
      subHeader: "ìŠ¤ë§ˆíŠ¸ ì¸ë² ìŠ¤íŠ¸ë¨¼íŠ¸", 
      titleMain: "ë°ì´í„°ë¡œ ì„¤ê³„í•˜ëŠ”", 
      titlePoint: "ETF í¬íŠ¸í´ë¦¬ì˜¤", 
      description: "ìµœì í™”ëœ ë°°ë‹¹ê³¼ ì„±ì¥ì˜ ë¹„ìœ¨ì„ ì œì•ˆí•©ë‹ˆë‹¤.", 
      type1: "í˜„ê¸ˆíë¦„í˜•", 
      type1Desc: "ì•ˆì •ì ì¸ ë°°ë‹¹ê¸ˆìœ¼ë¡œ ìƒí™œì„ ì„¤ê³„í•©ë‹ˆë‹¤.", 
      type2: "ì„±ì¥í˜•", 
      type2Desc: "ì‹œì¥ë³´ë‹¤ ë†’ì€ ìˆ˜ìµë¥ ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.", 
      type3: "í˜¼í•©í˜•", 
      type3Desc: "ì„±ì¥ê³¼ ë°°ë‹¹ì˜ ë°¸ëŸ°ìŠ¤ë¥¼ ì¶”êµ¬í•©ë‹ˆë‹¤.", 
      selectBtn: "ì „ëµ ì„ íƒí•˜ê¸° â†’", 
      resultTitle: "ë‚˜ì˜ ë§ì¶¤ í¬íŠ¸í´ë¦¬ì˜¤", 
      chartTitle: "í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘", 
      dividendLabel: "ì˜ˆìƒ ì›” ë°°ë‹¹ê¸ˆ", 
      inputKrw: "íˆ¬ì ì˜ˆì • ê¸ˆì•¡ (KRW)", 
      inputUsd: "íˆ¬ì ê¸ˆì•¡ (USD)", 
      yield: "ë°°ë‹¹ìˆ˜ìµë¥ ", 
      return1Y: "ê³¼ê±° 1ë…„ ìˆ˜ìµë¥ ", 
      return3Y: "ê³¼ê±° 3ë…„ ìˆ˜ìµë¥ ",
      lastUpdate: "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸",
      exchangeRate: "í™˜ìœ¨",
      saveBtn: "ì €ì¥",
      loadBtn: "ë¶ˆëŸ¬ì˜¤ê¸°",
      saveSuccess: "í¬íŠ¸í´ë¦¬ì˜¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!",
      loadSuccess: "í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!",
      loadFail: "ì €ì¥ëœ í¬íŠ¸í´ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤.",
      exchangeRateFail: "í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ ê¸°ë³¸ê°’(â‚©1,380)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.",
      apiFail: "API í˜¸ì¶œ ì‹¤íŒ¨. ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.",
      inputError: "ì…ë ¥ ê¸ˆì•¡ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ 999ì¡°)",
      totalWeightError: "ì´ ë¹„ì¤‘ì´ 100%ê°€ ì•„ë‹™ë‹ˆë‹¤. ì¡°ì •í•´ì£¼ì„¸ìš”."
    },
    en: { 
      lang: "ğŸŒ KOR", 
      subHeader: "Smart Investment", 
      titleMain: "Data-Driven", 
      titlePoint: "ETF Portfolio", 
      description: "Optimized ratio of dividends and growth.", 
      type1: "Cash Flow", 
      type1Desc: "Stable dividends for your second salary.", 
      type2: "Growth", 
      type2Desc: "Targeting market-beating returns.", 
      type3: "Balanced", 
      type3Desc: "Balance between growth and dividends.", 
      selectBtn: "Select Strategy â†’", 
      resultTitle: "My Custom Portfolio", 
      chartTitle: "Portfolio Allocation", 
      dividendLabel: "Est. Monthly Dividend", 
      inputKrw: "Total (KRW)", 
      inputUsd: "Target (USD)", 
      yield: "Yield", 
      return1Y: "1Y Return", 
      return3Y: "3Y Return",
      lastUpdate: "Last Update",
      exchangeRate: "Exchange Rate",
      saveBtn: "Save",
      loadBtn: "Load",
      saveSuccess: "Portfolio saved successfully!",
      loadSuccess: "Portfolio loaded!",
      loadFail: "No saved portfolio found.",
      exchangeRateFail: "Failed to fetch exchange rate. Using default (â‚©1,380).",
      apiFail: "API call failed. Using simulation data.",
      inputError: "Amount too large. (Max: 999T)",
      totalWeightError: "Total weight must be 100%."
    }
  };

  // ê°œì„ ëœ ë°ì´í„° êµ¬ì¡°: return1Y, return3Y, lastUpdated ì¶”ê°€
  const portfolios = {
    "í˜„ê¸ˆíë¦„í˜•": [
      {symbol:"SCHD", yield:3.45, weight:40, return1Y: null, return3Y: null, lastUpdated: null}, 
      {symbol:"JEPI", yield:7.12, weight:30, return1Y: null, return3Y: null, lastUpdated: null}, 
      {symbol:"O", yield:5.62, weight:20, return1Y: null, return3Y: null, lastUpdated: null}, 
      {symbol:"DGRO", yield:2.41, weight:10, return1Y: null, return3Y: null, lastUpdated: null}
    ],
    "ì„±ì¥í˜•": [
      {symbol:"QQQ", yield:0.65, weight:50, return1Y: null, return3Y: null, lastUpdated: null}, 
      {symbol:"SOXX", yield:0.71, weight:30, return1Y: null, return3Y: null, lastUpdated: null}, 
      {symbol:"VUG", yield:0.55, weight:20, return1Y: null, return3Y: null, lastUpdated: null}
    ],
    "í˜¼í•©í˜•": [
      {symbol:"VOO", yield:1.32, weight:40, return1Y: null, return3Y: null, lastUpdated: null}, 
      {symbol:"VTI", yield:1.45, weight:30, return1Y: null, return3Y: null, lastUpdated: null}, 
      {symbol:"SCHD", yield:3.45, weight:20, return1Y: null, return3Y: null, lastUpdated: null}, 
      {symbol:"DGRO", yield:2.41, weight:10, return1Y: null, return3Y: null, lastUpdated: null}
    ]
  };

  // ==========================================
  // ì „ì—­ ë³€ìˆ˜
  // ==========================================
  
  let currentLang = localStorage.getItem('lang') || 'ko';
  let currentExchangeRate = 1380;
  let currentEtfs = [];
  let chartInstance;
  let currentProfileType = '';
  let apiCache = new Map(); // API ì‘ë‹µ ìºì‹±

  // ==========================================
  // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
  // ==========================================

  // ì•Œë¦¼ í† ìŠ¤íŠ¸ í‘œì‹œ
  function showNotification(message, type = 'info') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    const colors = {
      info: 'bg-blue-600',
      success: 'bg-emerald-600',
      warning: 'bg-amber-600',
      error: 'bg-red-600'
    };
    
    toast.className = `${colors[type]} text-white px-6 py-4 rounded-2xl shadow-2xl font-bold text-sm pointer-events-auto toast-enter flex items-center gap-3 max-w-sm`;
    toast.innerHTML = `
      <span class="text-xl">${type === 'success' ? 'âœ“' : type === 'error' ? 'âœ•' : 'â„¹'}</span>
      <span>${message}</span>
    `;
    
    container.appendChild(toast);
    
    setTimeout(() => {
      toast.classList.remove('toast-enter');
      toast.classList.add('toast-exit');
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  // API ìºì‹± ì²˜ë¦¬
  function getCachedData(key) {
    const cached = apiCache.get(key);
    if (cached && Date.now() - cached.timestamp < API_CONFIG.cacheTimeout) {
      return cached.data;
    }
    return null;
  }

  function setCachedData(key, data) {
    apiCache.set(key, {
      data: data,
      timestamp: Date.now()
    });
  }

  // ì–¸ì–´ ì „í™˜
  async function toggleLanguage() { 
    currentLang = currentLang === 'ko' ? 'en' : 'ko'; 
    localStorage.setItem('lang', currentLang); 
    location.reload(); 
  }

  // ë‹¤í¬ëª¨ë“œ ì „í™˜
  function toggleDarkMode() { 
    document.documentElement.classList.toggle('dark'); 
    localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
    if(chartInstance) renderChart(); 
  }

  // ==========================================
  // í¬íŠ¸í´ë¦¬ì˜¤ ì„ íƒ ë° ë Œë”ë§
  // ==========================================

  async function selectProfile(key) {
    currentProfileType = key;
    document.getElementById("liveStatus").classList.remove("hidden");
    currentEtfs = JSON.parse(JSON.stringify(portfolios[key]));
    
    await new Promise(r => setTimeout(r, 600)); 
    document.getElementById("liveStatus").classList.add("hidden");
    document.getElementById("portfolioSection").classList.remove("hidden");
    
    renderEtfList();
    renderChart();
    simulatePortfolio();
    
    window.scrollTo({ 
      top: document.getElementById("portfolioSection").offsetTop - 50, 
      behavior: 'smooth' 
    });
  }

  function renderEtfList() {
    const list = document.getElementById("etfList");
    list.innerHTML = "";
    
    currentEtfs.forEach((etf, idx) => {
      const bgColor = cardLightColors[idx % cardLightColors.length];
      const borderColor = chartColors[idx % chartColors.length];
      const card = document.createElement("div");
      
      card.style.backgroundColor = bgColor;
      card.style.borderColor = borderColor;
      card.className = "p-8 rounded-[2.5rem] border-2 shadow-sm transition-all relative overflow-hidden cursor-pointer hover:scale-105";
      card.setAttribute('role', 'button');
      card.setAttribute('tabindex', '0');
      card.setAttribute('aria-label', `${etf.symbol} ìƒì„¸ ì •ë³´ ë³´ê¸°`);
      
      card.onclick = (e) => { 
        if(e.target.type !== 'range') openModal(idx); 
      };
      
      card.onkeydown = (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openModal(idx);
        }
      };
      
      card.innerHTML = `
        <div class="flex justify-between items-start mb-6">
          <h3 class="text-3xl font-black">${etf.symbol}</h3>
          <span id="badge-${idx}" class="px-3 py-1 rounded-lg text-xs font-black text-white" style="background-color: ${borderColor}">${etf.weight}%</span>
        </div>
        <input 
          type="range" 
          min="0" 
          max="100" 
          value="${etf.weight}" 
          id="slider-${idx}" 
          class="w-full mb-4 cursor-pointer" 
          oninput="updateWeight(${idx}, this.value)"
          aria-label="${etf.symbol} ë¹„ì¤‘ ì¡°ì •"
        >
        <div class="pt-4 border-t border-black/5 dark:border-white/5 text-xs flex justify-between font-bold">
          <span class="text-slate-500 uppercase tracking-tighter">${translations[currentLang].yield}</span>
          <span style="color: ${borderColor}" id="yield-display-${idx}">${etf.yield}%</span>
        </div>
      `;
      
      list.appendChild(card);
    });
  }

  function updateWeight(idx, val) {
    const value = parseInt(val);
    if (isNaN(value) || value < 0 || value > 100) return;
    
    currentEtfs[idx].weight = value;
    document.getElementById(`badge-${idx}`).textContent = `${value}%`;
    
    const total = currentEtfs.reduce((s, e) => s + e.weight, 0);
    document.getElementById("totalWeightDisplay").textContent = total;
    
    const totalBadge = document.getElementById("weightBadgeParent");
    totalBadge.className = `px-4 py-1.5 rounded-xl text-sm font-bold ${total === 100 ? 'bg-blue-600 text-white' : 'bg-red-500 text-white'}`;
    
    if (total !== 100) {
      showNotification(translations[currentLang].totalWeightError, 'warning');
    }
    
    if(chartInstance) {
      chartInstance.data.datasets[0].data = currentEtfs.map(e => e.weight);
      chartInstance.update('none');
    }
    
    simulatePortfolio();
  }

  // ==========================================
  // ëª¨ë‹¬ ê´€ë¦¬
  // ==========================================

  async function openModal(idx) {
    const etf = currentEtfs[idx];
    const modal = document.getElementById("detailModal");
    const content = document.getElementById("modalContent");
    const statusText = document.getElementById("modalStatus");
    const skeleton = document.getElementById("modalSkeleton");
    const dataContent = document.getElementById("modalData");
    
    // ëª¨ë‹¬ ì´ˆê¸°í™”
    document.getElementById("modalTitle").textContent = etf.symbol;
    document.getElementById("modalDiv").textContent = etf.yield + "%"; 
    document.getElementById("modal1Y").textContent = "-";
    document.getElementById("modal3Y").textContent = "-";
    document.getElementById("modalLastUpdate").textContent = "-";
    
    // ëª¨ë‹¬ í‘œì‹œ
    modal.classList.remove("hidden");
    document.body.style.overflow = "hidden";
    
    setTimeout(() => {
      content.classList.remove("scale-95", "opacity-0");
      content.classList.add("scale-100", "opacity-100");
    }, 10);

    // ìºì‹œ í™•ì¸
    const cachedData = getCachedData(etf.symbol);
    if (cachedData) {
      displayEtfData(idx, cachedData);
      statusText.textContent = "Cached Data";
      statusText.className = "text-xs font-bold text-emerald-500 mt-1 uppercase tracking-widest";
      return;
    }

    // ìŠ¤ì¼ˆë ˆí†¤ í‘œì‹œ
    skeleton.classList.remove("hidden");
    dataContent.classList.add("hidden");

    try {
      statusText.textContent = "Fetching...";
      statusText.className = "text-xs font-bold text-blue-500 mt-1 uppercase tracking-widest";

      // âš ï¸ ì‹¤ì œ í”„ë¡œë•ì…˜ì—ì„œëŠ” ë°±ì—”ë“œ Proxyë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
      const response = await fetch(
        `${API_CONFIG.baseUrl}/profile/${etf.symbol}?apikey=${API_CONFIG.key}`,
        { 
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        }
      );
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
      
      const data = await response.json();

      if (data && data.length > 0) {
        const profile = data[0];
        
        // ë°ì´í„° ìºì‹±
        setCachedData(etf.symbol, profile);
        
        // UI ì—…ë°ì´íŠ¸
        displayEtfData(idx, profile);
        
        statusText.textContent = "Live Data Synced";
        statusText.className = "text-xs font-bold text-emerald-500 mt-1 uppercase tracking-widest";
      } else {
        throw new Error("No Data");
      }
    } catch (error) {
      console.error('API Error:', error);
      
      statusText.textContent = "Simulation Mode";
      statusText.className = "text-xs font-bold text-amber-500 mt-1 uppercase tracking-widest";
      
      showNotification(translations[currentLang].apiFail, 'warning');
      
      // ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ìƒì„±
      const mockData = {
        lastDiv: etf.yield / 100 * 50, // ê°€ìƒ ì£¼ê°€ $50 ê¸°ì¤€
        price: 50,
        changes: (Math.random() * 4 - 2).toFixed(2),
        mock1Y: (Math.random() * (15 - 5) + 5).toFixed(2),
        mock3Y: (Math.random() * (40 - 15) + 15).toFixed(2)
      };
      
      displayEtfData(idx, mockData, true);
    } finally {
      skeleton.classList.add("hidden");
      dataContent.classList.remove("hidden");
    }
  }

  function displayEtfData(idx, profile, isMock = false) {
    const etf = currentEtfs[idx];
    
    // ë°°ë‹¹ìˆ˜ìµë¥  ê³„ì‚°
    const realYield = isMock 
      ? etf.yield 
      : profile.lastDiv 
        ? ((profile.lastDiv / profile.price) * 100).toFixed(2) 
        : etf.yield;
    
    // ìˆ˜ìµë¥  ë°ì´í„°
    const return1Y = isMock 
      ? `â‰ˆ +${profile.mock1Y}% (Est.)` 
      : profile.changes 
        ? `${profile.changes > 0 ? '+' : ''}${profile.changes.toFixed(2)}% (Day)` 
        : "N/A";
    
    const return3Y = isMock 
      ? `â‰ˆ +${profile.mock3Y}% (Est.)` 
      : profile.exchangeShortName 
        ? `Market: ${profile.exchangeShortName}` 
        : "N/A";
    
    // UI ì—…ë°ì´íŠ¸
    document.getElementById("modalDiv").textContent = realYield + "%";
    document.getElementById("modal1Y").textContent = return1Y;
    document.getElementById("modal3Y").textContent = return3Y;
    document.getElementById("modalLastUpdate").textContent = new Date().toLocaleString(currentLang === 'ko' ? 'ko-KR' : 'en-US');
    
    // ë©”ì¸ ë¦¬ìŠ¤íŠ¸ ë™ê¸°í™”
    currentEtfs[idx].yield = parseFloat(realYield);
    currentEtfs[idx].return1Y = return1Y;
    currentEtfs[idx].return3Y = return3Y;
    currentEtfs[idx].lastUpdated = new Date().toISOString();
    
    document.getElementById(`yield-display-${idx}`).textContent = realYield + "%";
    
    // ë°°ë‹¹ê¸ˆ ì¬ê³„ì‚°
    simulatePortfolio();
  }

  function closeModal() {
    const modal = document.getElementById("detailModal");
    const content = document.getElementById("modalContent");
    
    content.classList.remove("scale-100", "opacity-100");
    content.classList.add("scale-95", "opacity-0");
    
    setTimeout(() => {
      modal.classList.add("hidden");
      document.body.style.overflow = "auto";
    }, 200);
  }

  // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      const modal = document.getElementById("detailModal");
      if (!modal.classList.contains('hidden')) {
        closeModal();
      }
    }
  });

  // ==========================================
  // ì°¨íŠ¸ ë Œë”ë§
  // ==========================================

  function renderChart() {
    const ctx = document.getElementById('portfolioChart').getContext('2d');
    
    if(chartInstance) chartInstance.destroy();
    
    const isDark = document.documentElement.classList.contains('dark');
    
    chartInstance = new Chart(ctx, {
      type: 'doughnut',
      data: { 
        labels: currentEtfs.map(e => e.symbol), 
        datasets:[{ 
          data: currentEtfs.map(e => e.weight), 
          backgroundColor: chartColors, 
          borderWidth: 0,
          hoverOffset: 15
        }] 
      },
      options: { 
        cutout: '75%', 
        plugins: { 
          legend: { 
            display: true,
            position: 'bottom',
            labels: {
              color: isDark ? '#cbd5e1' : '#334155',
              font: {
                size: 12,
                weight: 'bold'
              },
              padding: 15
            }
          },
          tooltip: {
            backgroundColor: isDark ? '#1e293b' : '#ffffff',
            titleColor: isDark ? '#f1f5f9' : '#0f172a',
            bodyColor: isDark ? '#cbd5e1' : '#475569',
            borderColor: isDark ? '#475569' : '#e2e8f0',
            borderWidth: 1,
            padding: 12,
            displayColors: true,
            callbacks: {
              label: function(context) {
                return `${context.label}: ${context.parsed}%`;
              }
            }
          }
        }, 
        animation: { 
          duration: 800,
          easing: 'easeInOutQuart'
        },
        onClick: (e, items) => {
          if (items.length > 0) {
            const idx = items[0].index;
            openModal(idx);
          }
        }
      }
    });
  }

  // ==========================================
  // ë°°ë‹¹ê¸ˆ ì‹œë®¬ë ˆì´ì…˜
  // ==========================================

  function simulatePortfolio() {
    const rawVal = document.getElementById("totalInvestment").value.replace(/,/g, "");
    const total = parseFloat(rawVal) || 0;
    
    let mUSD = 0; 
    let totalYield = 0;
    
    currentEtfs.forEach(e => {
      mUSD += (total * (e.weight / 100)) * (e.yield / 100) / 12;
      totalYield += (e.yield * (e.weight / 100));
    });
    
    document.getElementById("valUSD").textContent = `$${mUSD.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
    document.getElementById("valKRW").textContent = `â‚©${Math.floor(mUSD * currentExchangeRate).toLocaleString()}`;
    
    const badge = document.getElementById("annualYieldBadge");
    if(total > 0) {
      badge.classList.remove("hidden");
      document.getElementById("annualYieldValue").textContent = totalYield.toFixed(2);
    } else { 
      badge.classList.add("hidden"); 
    }
  }

  // ==========================================
  // í†µí™” ì…ë ¥ ì²˜ë¦¬ (ê°œì„ ëœ ê²€ì¦)
  // ==========================================

  function handleCurrencyInput(el, type) {
    let val = el.value.replace(/[^0-9]/g, "");
    
    if(!val) { 
      document.getElementById("totalInvestment").value = "";
      document.getElementById("totalInvestmentKRW").value = "";
      simulatePortfolio(); 
      return; 
    }
    
    // ìµœëŒ€ ê¸ˆì•¡ ì œí•œ (999ì¡°)
    const maxAmount = 999999999999999;
    if (parseFloat(val) > maxAmount) {
      showNotification(translations[currentLang].inputError, 'error');
      val = maxAmount.toString();
    }
    
    el.value = Number(val).toLocaleString();
    
    if(type === 'KRW') {
      const usdValue = (val / currentExchangeRate).toFixed(2);
      document.getElementById("totalInvestment").value = Number(usdValue).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
    } else {
      const krwValue = Math.floor(val * currentExchangeRate);
      document.getElementById("totalInvestmentKRW").value = krwValue.toLocaleString();
    }
    
    simulatePortfolio();
  }

  // ==========================================
  // í¬íŠ¸í´ë¦¬ì˜¤ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
  // ==========================================

  function savePortfolio() {
    if (currentEtfs.length === 0) {
      showNotification('ì €ì¥í•  í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
      return;
    }
    
    const portfolio = {
      type: currentProfileType,
      etfs: currentEtfs,
      investment: document.getElementById("totalInvestment").value,
      investmentKRW: document.getElementById("totalInvestmentKRW").value,
      timestamp: new Date().toISOString(),
      version: '1.0'
    };
    
    try {
      localStorage.setItem('myPortfolio', JSON.stringify(portfolio));
      showNotification(translations[currentLang].saveSuccess, 'success');
    } catch(e) {
      console.error('Save error:', e);
      showNotification('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì €ì¥ ê³µê°„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
    }
  }

  function loadPortfolio() {
    try {
      const saved = localStorage.getItem('myPortfolio');
      
      if (!saved) {
        showNotification(translations[currentLang].loadFail, 'warning');
        return;
      }
      
      const portfolio = JSON.parse(saved);
      
      // ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
      if (!portfolio.etfs || !Array.isArray(portfolio.etfs)) {
        throw new Error('Invalid portfolio data');
      }
      
      currentProfileType = portfolio.type;
      currentEtfs = portfolio.etfs;
      
      document.getElementById("totalInvestment").value = portfolio.investment || "";
      document.getElementById("totalInvestmentKRW").value = portfolio.investmentKRW || "";
      
      document.getElementById("portfolioSection").classList.remove("hidden");
      
      renderEtfList();
      renderChart();
      simulatePortfolio();
      
      showNotification(translations[currentLang].loadSuccess, 'success');
      
      window.scrollTo({ 
        top: document.getElementById("portfolioSection").offsetTop - 50, 
        behavior: 'smooth' 
      });
    } catch(e) {
      console.error('Load error:', e);
      showNotification('í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
    }
  }

  // ==========================================
  // ì´ˆê¸°í™”
  // ==========================================

  (async function init() {
    // ë‹¤í¬ëª¨ë“œ ë³µì›
    const savedDarkMode = localStorage.getItem('darkMode');
    if (savedDarkMode === 'true') {
      document.documentElement.classList.add('dark');
    }
    
    // í™˜ìœ¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    try {
      const res = await fetch('https://open.er-api.com/v6/latest/USD');
      
      if (!res.ok) {
        throw new Error('Exchange rate API error');
      }
      
      const data = await res.json();
      
      if(data.rates && data.rates.KRW) {
        currentExchangeRate = data.rates.KRW;
        document.getElementById("exchangeRateValue").textContent = `â‚©${currentExchangeRate.toLocaleString(undefined, {maximumFractionDigits:2})}`;
        document.getElementById("exchangeRateStatus").classList.remove("hidden");
      } else {
        throw new Error('KRW rate not found');
      }
    } catch(e) {
      console.error('Exchange rate error:', e);
      showNotification(translations[currentLang].exchangeRateFail, 'warning');
      document.getElementById("exchangeRateValue").textContent = `â‚©${currentExchangeRate.toLocaleString()} (ê¸°ë³¸ê°’)`;
    }
    
    // ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ ì ìš©
    document.querySelectorAll('[data-i18n]').forEach(element => { 
      const key = element.getAttribute('data-i18n');
      if (translations[currentLang][key]) {
        element.innerHTML = translations[currentLang][key]; 
      }
    });
    
    document.getElementById('langBtn').textContent = translations[currentLang].lang;
    
    console.log('âœ… BUYETF initialized successfully');
  })();
</script>

</body>
</html>