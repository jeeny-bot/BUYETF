<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q1R68MMF2P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q1R68MMF2P');
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BUYETF | ì¸í…”ë¦¬ì „íŠ¸ ETF í¬íŠ¸í´ë¦¬ì˜¤</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Pretendard', sans-serif; transition: background-color 0.1s ease, color 0.1s ease; }
    .card-hover:hover { transform: translateY(-8px); shadow: 0 20px 40px rgba(0,0,0,0.1); }
    input[type="range"] { -webkit-appearance: none; background: rgba(0,0,0,0.05); border-radius: 99px; height: 6px; outline: none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #1e293b; cursor: pointer; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: transform 0.1s ease; }
    input[type="range"]::-webkit-slider-thumb:active { transform: scale(1.3); }
    .dark input[type="range"]::-webkit-slider-thumb { background: #f8fafc; border-color: #0f172a; }
    .modal-overlay { backdrop-filter: blur(8px); transition: all 0.3s ease; }
  </style>
</head>
<body class="bg-[#F8FAFC] text-slate-900 dark:bg-slate-950 dark:text-slate-100">

<div class="fixed top-6 right-6 z-[100] flex gap-3">
  <button onclick="toggleLanguage()" id="langBtn" class="flex items-center gap-2 px-4 py-2 rounded-full bg-white dark:bg-slate-800 shadow-lg border border-slate-200 dark:border-slate-700 font-bold text-sm">ğŸŒ ENG</button>
  <button onclick="toggleDarkMode()" class="flex items-center gap-2 px-4 py-2 rounded-full bg-white dark:bg-slate-800 shadow-lg border border-slate-200 dark:border-slate-700 text-sm">
    <span class="dark:hidden">ğŸŒ™ Dark</span>
    <span class="hidden dark:inline">â˜€ï¸ Light</span>
  </button>
</div>

<section class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 py-24">
  <div class="max-w-5xl mx-auto px-6 text-center">
    <div class="flex justify-center mb-8">
      <span class="inline-flex items-center gap-3 px-6 py-2.5 text-lg font-black tracking-tighter uppercase rounded-full border-2 border-blue-600/10 bg-blue-50/30 dark:bg-blue-900/20">
        <span class="text-blue-600 dark:text-blue-400">BUYETF</span>
        <span class="text-slate-400">|</span>
        <span class="text-slate-600 dark:text-slate-300 font-bold text-sm" data-i18n="subHeader">ìŠ¤ë§ˆíŠ¸ ì¸ë² ìŠ¤íŠ¸ë¨¼íŠ¸</span>
      </span>
    </div>
    <h1 class="text-6xl font-black tracking-tighter mb-8 leading-tight">
      <span data-i18n="titleMain">ë°ì´í„°ë¡œ ì„¤ê³„í•˜ëŠ”</span> <span class="text-blue-600 dark:text-blue-400" data-i18n="titlePoint">ETF í¬íŠ¸í´ë¦¬ì˜¤</span>
    </h1>
    <p class="text-xl text-slate-500 dark:text-slate-400 font-medium" data-i18n="description">ìµœì í™”ëœ ë°°ë‹¹ê³¼ ì„±ì¥ì˜ ë¹„ìœ¨ì„ ì œì•ˆí•©ë‹ˆë‹¤.</p>
  </div>
</section>

<section class="py-24 -mt-12 relative z-10">
  <div class="max-w-7xl mx-auto px-6">
    <div class="grid md:grid-cols-3 gap-10 text-center">
      <button onclick="selectProfile('í˜„ê¸ˆíë¦„í˜•')" class="group card-hover bg-white dark:bg-slate-900 p-12 rounded-[2.5rem] border-2 border-emerald-100 dark:border-emerald-900/30 transition-all text-left flex flex-col justify-between min-h-[420px] shadow-sm hover:border-emerald-400">
        <div><div class="w-20 h-20 bg-emerald-500 rounded-[1.5rem] flex items-center justify-center text-4xl mb-8 shadow-lg group-hover:scale-110 transition-transform">ğŸ’°</div><h3 class="text-3xl font-extrabold mb-4 text-emerald-900 dark:text-emerald-400 tracking-tight" data-i18n="type1">í˜„ê¸ˆíë¦„í˜•</h3><p class="text-lg text-slate-500 dark:text-slate-400 leading-relaxed font-medium" data-i18n="type1Desc">ì•ˆì •ì ì¸ ë°°ë‹¹ê¸ˆìœ¼ë¡œ ìƒí™œì„ ì„¤ê³„í•©ë‹ˆë‹¤.</p></div>
        <div class="mt-8 flex items-center text-emerald-600 font-bold italic" data-i18n="selectBtn">ì „ëµ ì„ íƒí•˜ê¸° â†’</div>
      </button>
      <button onclick="selectProfile('ì„±ì¥í˜•')" class="group card-hover bg-white dark:bg-slate-900 p-12 rounded-[2.5rem] border-2 border-blue-100 dark:border-blue-900/30 transition-all text-left flex flex-col justify-between min-h-[420px] shadow-sm hover:border-blue-400">
        <div><div class="w-20 h-20 bg-blue-500 rounded-[1.5rem] flex items-center justify-center text-4xl mb-8 shadow-lg group-hover:scale-110 transition-transform">ğŸ“ˆ</div><h3 class="text-3xl font-extrabold mb-4 text-blue-900 dark:text-blue-400 tracking-tight" data-i18n="type2">ì„±ì¥í˜•</h3><p class="text-lg text-slate-500 dark:text-slate-400 leading-relaxed font-medium" data-i18n="type2Desc">ì‹œì¥ë³´ë‹¤ ë†’ì€ ìˆ˜ìµë¥ ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.</p></div>
        <div class="mt-8 flex items-center text-blue-600 font-bold italic" data-i18n="selectBtn">ì „ëµ ì„ íƒí•˜ê¸° â†’</div>
      </button>
      <button onclick="selectProfile('í˜¼í•©í˜•')" class="group card-hover bg-white dark:bg-slate-900 p-12 rounded-[2.5rem] border-2 border-amber-100 dark:border-amber-900/30 transition-all text-left flex flex-col justify-between min-h-[420px] shadow-sm hover:border-amber-400">
        <div><div class="w-20 h-20 bg-amber-500 rounded-[1.5rem] flex items-center justify-center text-4xl mb-8 shadow-lg group-hover:scale-110 transition-transform">âš–ï¸</div><h3 class="text-3xl font-extrabold mb-4 text-amber-900 dark:text-amber-400 tracking-tight" data-i18n="type3">í˜¼í•©í˜•</h3><p class="text-lg text-slate-500 dark:text-slate-400 leading-relaxed font-medium" data-i18n="type3Desc">ì„±ì¥ê³¼ ë°°ë‹¹ì˜ ë°¸ëŸ°ìŠ¤ë¥¼ ì¶”êµ¬í•©ë‹ˆë‹¤.</p></div>
        <div class="mt-11 flex items-center text-amber-600 font-bold italic" data-i18n="selectBtn">ì „ëµ ì„ íƒí•˜ê¸° â†’</div>
      </button>
    </div>
  </div>
</section>

<section id="portfolioSection" class="py-24 bg-slate-100 dark:bg-slate-800/50 hidden border-t border-slate-200 dark:border-slate-800">
  <div class="max-w-6xl mx-auto px-6">
    <div class="flex items-center justify-between mb-12">
      <div class="flex items-baseline gap-4">
        <h2 class="text-4xl font-black tracking-tighter" data-i18n="resultTitle">ë‚˜ì˜ ë§ì¶¤ í¬íŠ¸í´ë¦¬ì˜¤</h2>
        <div id="weightBadgeParent" class="px-4 py-1.5 rounded-xl bg-blue-600 text-white text-sm font-bold">
          Total: <span id="totalWeightDisplay">100</span>%
          <span id="liveStatus" class="ml-2 text-[10px] text-blue-200 animate-pulse hidden">LIVE SYNC...</span>
        </div>
      </div>
    </div>
    
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12" id="etfList"></div>

    <div class="grid lg:grid-cols-2 gap-8">
      <div class="bg-white dark:bg-slate-900 p-10 rounded-[2.5rem] shadow-sm border border-slate-200 dark:border-slate-800 text-center">
        <h3 class="text-xl font-bold mb-8 flex items-center justify-center"><span class="w-1.5 h-6 bg-blue-600 rounded-full mr-3"></span><span data-i18n="chartTitle">í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘</span></h3>
        <div class="max-w-[300px] mx-auto"><canvas id="portfolioChart"></canvas></div>
      </div>

      <div class="bg-slate-900 dark:bg-black text-white p-10 rounded-[2.5rem] shadow-2xl flex flex-col border border-slate-800">
        <div class="flex items-center gap-3 mb-6">
          <h3 class="text-2xl text-slate-400 font-black uppercase tracking-wider" data-i18n="dividendLabel">ì˜ˆìƒ ì›” ë°°ë‹¹ê¸ˆ</h3>
          <div id="annualYieldBadge" class="hidden px-4 py-1.5 rounded-full bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 text-sm font-black">
            <span data-i18n="yield">ë°°ë‹¹ìˆ˜ìµë¥ </span> <span id="annualYieldValue">0</span>%
          </div>
        </div>
        
        <div id="monthlyDividendDisplay" class="mb-10">
          <p class="text-7xl font-black text-blue-400 tracking-tighter" id="valUSD">$0.00</p>
          <div class="inline-flex items-center gap-3 px-6 py-3 rounded-2xl bg-slate-800/60 border border-slate-700/50 mt-6">
            <span class="text-2xl text-slate-500 font-bold">â‰ˆ</span>
            <span class="text-3xl font-black text-slate-300" id="valKRW">â‚©0</span>
          </div>
        </div>
        
        <div class="space-y-6 border-t border-slate-800 pt-8 mt-auto">
          <div class="bg-slate-800/40 p-8 rounded-[2rem] border border-slate-800/50">
            <div class="mb-8">
              <label class="text-xl text-slate-400 font-black uppercase tracking-wider block mb-4" data-i18n="inputKrw">íˆ¬ì ì˜ˆì • ê¸ˆì•¡ (KRW)</label>
              <input type="text" id="totalInvestmentKRW" class="w-full bg-transparent border-none p-0 text-white font-black text-5xl focus:ring-0 outline-none" placeholder="0" oninput="handleCurrencyInput(this, 'KRW')">
            </div>
            <div class="border-t border-slate-800/30 my-8"></div>
            <div>
              <label class="text-xl text-slate-400 font-black uppercase tracking-wider block mb-4" data-i18n="inputUsd">ì˜ˆìƒ íˆ¬ì ê¸ˆì•¡ (USD)</label>
              <input type="text" id="totalInvestment" class="w-full bg-transparent border-none p-0 text-slate-400 font-black text-3xl focus:ring-0 outline-none" placeholder="0" oninput="handleCurrencyInput(this, 'USD')">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div id="detailModal" class="fixed inset-0 z-[200] flex items-center justify-center hidden">
  <div class="absolute inset-0 bg-slate-900/60 modal-overlay" onclick="closeModal()"></div>
  <div class="bg-white dark:bg-slate-900 w-full max-w-lg mx-6 p-10 rounded-[3rem] relative z-[210] shadow-2xl border border-slate-200 dark:border-slate-800 transform transition-all scale-95 opacity-0" id="modalContent">
    <div class="flex justify-between items-center mb-8">
      <div>
        <h3 id="modalTitle" class="text-4xl font-black tracking-tighter uppercase">ETF Info</h3>
        <p id="modalStatus" class="text-xs font-bold text-blue-500 mt-1 uppercase tracking-widest">Ready</p>
      </div>
      <button type="button" onclick="closeModal()" class="text-slate-400 hover:text-slate-900 dark:hover:text-white text-3xl p-2 focus:outline-none">âœ•</button>
    </div>
    <div class="space-y-6">
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl border border-slate-100 dark:border-slate-700">
        <span class="font-bold text-slate-500" data-i18n="yield">ë°°ë‹¹ìˆ˜ìµë¥ </span>
        <span id="modalDiv" class="font-black text-blue-600 text-xl">-</span>
      </div>
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl border border-slate-100 dark:border-slate-700">
        <span class="font-bold text-slate-500" data-i18n="return1Y">1ë…„ ìˆ˜ìµë¥ </span>
        <span id="modal1Y" class="font-black text-emerald-500 text-xl">-</span>
      </div>
      <div class="flex justify-between p-6 bg-slate-50 dark:bg-slate-800 rounded-3xl border border-slate-100 dark:border-slate-700">
        <span class="font-bold text-slate-500" data-i18n="return3Y">3ë…„ ìˆ˜ìµë¥ </span>
        <span id="modal3Y" class="font-black text-emerald-500 text-xl">-</span>
      </div>
    </div>
  </div>
</div>

<script>
  const API_KEY = 'LjXZQ9T5YNoz7V1Riy47qTRTc8EnWe4T'; 

  const chartColors = ['#2563eb', '#10b981', '#f59e0b', '#8b5cf6'];
  const cardLightColors = ['rgba(37, 99, 235, 0.08)', 'rgba(16, 185, 129, 0.08)', 'rgba(245, 158, 11, 0.08)', 'rgba(139, 92, 246, 0.08)'];

  const translations = {
    ko: { lang: "ğŸŒ ENG", subHeader: "ìŠ¤ë§ˆíŠ¸ ì¸ë² ìŠ¤íŠ¸ë¨¼íŠ¸", titleMain: "ë°ì´í„°ë¡œ ì„¤ê³„í•˜ëŠ”", titlePoint: "ETF í¬íŠ¸í´ë¦¬ì˜¤", description: "ìµœì í™”ëœ ë°°ë‹¹ê³¼ ì„±ì¥ì˜ ë¹„ìœ¨ì„ ì œì•ˆí•©ë‹ˆë‹¤.", type1: "í˜„ê¸ˆíë¦„í˜•", type1Desc: "ì•ˆì •ì ì¸ ë°°ë‹¹ê¸ˆìœ¼ë¡œ ìƒí™œì„ ì„¤ê³„í•©ë‹ˆë‹¤.", type2: "ì„±ì¥í˜•", type2Desc: "ì‹œì¥ë³´ë‹¤ ë†’ì€ ìˆ˜ìµë¥ ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.", type3: "í˜¼í•©í˜•", type3Desc: "ì„±ì¥ê³¼ ë°°ë‹¹ì˜ ë°¸ëŸ°ìŠ¤ë¥¼ ì¶”êµ¬í•©ë‹ˆë‹¤.", selectBtn: "ì „ëµ ì„ íƒí•˜ê¸° â†’", resultTitle: "ë‚˜ì˜ ë§ì¶¤ í¬íŠ¸í´ë¦¬ì˜¤", chartTitle: "í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘", dividendLabel: "ì˜ˆìƒ ì›” ë°°ë‹¹ê¸ˆ", inputKrw: "íˆ¬ì ì˜ˆì • ê¸ˆì•¡ (KRW)", inputUsd: "íˆ¬ì ê¸ˆì•¡ (USD)", yield: "ë°°ë‹¹ìˆ˜ìµë¥ ", return1Y: "1ë…„ ìˆ˜ìµë¥ ", return3Y: "3ë…„ ìˆ˜ìµë¥ " },
    en: { lang: "ğŸŒ KOR", subHeader: "Smart Investment", titleMain: "Data-Driven", titlePoint: "ETF Portfolio", description: "Optimized ratio of dividends and growth.", type1: "Cash Flow", type1Desc: "Stable dividends for your second salary.", type2: "Growth", type2Desc: "Targeting market-beating returns.", type3: "Balanced", type3Desc: "Balance between growth and dividends.", selectBtn: "Select Strategy â†’", resultTitle: "My Custom Portfolio", chartTitle: "Portfolio Allocation", dividendLabel: "Est. Monthly Dividend", inputKrw: "Total (KRW)", inputUsd: "Target (USD)", yield: "Yield", return1Y: "1Y Return", return3Y: "3Y Return" }
  };

  const portfolios = {
    "í˜„ê¸ˆíë¦„í˜•": [{symbol:"SCHD", yield:3.45, weight:40}, {symbol:"JEPI", yield:7.12, weight:30}, {symbol:"O", yield:5.62, weight:20}, {symbol:"DGRO", yield:2.41, weight:10}],
    "ì„±ì¥í˜•": [{symbol:"QQQ", yield:0.65, weight:50}, {symbol:"SOXX", yield:0.71, weight:30}, {symbol:"VUG", yield:0.55, weight:20}],
    "í˜¼í•©í˜•": [{symbol:"VOO", yield:1.32, weight:40}, {symbol:"VTI", yield:1.45, weight:30}, {symbol:"SCHD", yield:3.45, weight:20}, {symbol:"DGRO", yield:2.41, weight:10}]
  };

  let currentLang = localStorage.getItem('lang') || 'ko';
  let currentExchangeRate = 1380;
  let currentEtfs = [];
  let chartInstance;

  async function toggleLanguage() { currentLang = currentLang === 'ko' ? 'en' : 'ko'; localStorage.setItem('lang', currentLang); location.reload(); }
  function toggleDarkMode() { document.documentElement.classList.toggle('dark'); if(chartInstance) renderChart(); }

  async function selectProfile(key) {
    document.getElementById("liveStatus").classList.remove("hidden");
    currentEtfs = JSON.parse(JSON.stringify(portfolios[key]));
    await new Promise(r => setTimeout(r, 600)); 
    document.getElementById("liveStatus").classList.add("hidden");
    document.getElementById("portfolioSection").classList.remove("hidden");
    renderEtfList();
    renderChart();
    simulatePortfolio();
    window.scrollTo({ top: document.getElementById("portfolioSection").offsetTop - 50, behavior: 'smooth' });
  }

  function renderEtfList() {
    const list = document.getElementById("etfList");
    list.innerHTML = "";
    currentEtfs.forEach((etf, idx) => {
      const bgColor = cardLightColors[idx % cardLightColors.length];
      const borderColor = chartColors[idx % chartColors.length];
      const card = document.createElement("div");
      card.style.backgroundColor = bgColor;
      card.style.borderColor = borderColor;
      card.className = "p-8 rounded-[2.5rem] border-2 shadow-sm transition-all relative overflow-hidden cursor-pointer";
      card.onclick = (e) => { if(e.target.type !== 'range') openModal(idx); };
      card.innerHTML = `
        <div class="flex justify-between items-start mb-6">
          <h3 class="text-3xl font-black">${etf.symbol}</h3>
          <span id="badge-${idx}" class="px-3 py-1 rounded-lg text-xs font-black text-white" style="background-color: ${borderColor}">${etf.weight}%</span>
        </div>
        <input type="range" min="0" max="100" value="${etf.weight}" id="slider-${idx}" class="w-full mb-4 cursor-pointer" oninput="updateWeight(${idx}, this.value)">
        <div class="pt-4 border-t border-black/5 dark:border-white/5 text-xs flex justify-between font-bold">
          <span class="text-slate-500 uppercase tracking-tighter">${translations[currentLang].yield}</span>
          <span style="color: ${borderColor}" id="yield-display-${idx}">${etf.yield}%</span>
        </div>
      `;
      list.appendChild(card);
    });
  }

  function updateWeight(idx, val) {
    const value = parseInt(val);
    currentEtfs[idx].weight = value;
    document.getElementById(`badge-${idx}`).textContent = `${value}%`;
    const total = currentEtfs.reduce((s, e) => s + e.weight, 0);
    document.getElementById("totalWeightDisplay").textContent = total;
    const totalBadge = document.getElementById("weightBadgeParent");
    totalBadge.className = `px-4 py-1.5 rounded-xl text-sm font-bold ${total === 100 ? 'bg-blue-600 text-white' : 'bg-red-500 text-white'}`;
    if(chartInstance) {
      chartInstance.data.datasets[0].data = currentEtfs.map(e => e.weight);
      chartInstance.update('none');
    }
    simulatePortfolio();
  }

  // â˜… ëª¨ë‹¬ ì—´ê¸° ë° API í˜¸ì¶œ
  async function openModal(idx) {
    const etf = currentEtfs[idx];
    const modal = document.getElementById("detailModal");
    const content = document.getElementById("modalContent");
    const statusText = document.getElementById("modalStatus");
    
    document.getElementById("modalTitle").textContent = etf.symbol;
    document.getElementById("modalDiv").textContent = etf.yield + "%"; 
    document.getElementById("modal1Y").textContent = "Calculating...";
    document.getElementById("modal3Y").textContent = "Calculating...";
    
    modal.classList.remove("hidden");
    document.body.style.overflow = "hidden"; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
    
    setTimeout(() => {
      content.classList.remove("scale-95", "opacity-0");
      content.classList.add("scale-100", "opacity-100");
    }, 10);

    try {
      statusText.textContent = "Connecting...";
      statusText.className = "text-xs font-bold text-blue-500 mt-1 uppercase";

      const response = await fetch(`https://financialmodelingprep.com/api/v3/profile/${etf.symbol}?apikey=${API_KEY}`);
      if (!response.ok) throw new Error("API Limit");
      
      const data = await response.json();

      if (data && data.length > 0) {
        const profile = data[0];
        const realYield = profile.lastDiv ? ((profile.lastDiv / profile.price) * 100).toFixed(2) : etf.yield;
        
        document.getElementById("modalDiv").textContent = realYield + "%";
        document.getElementById("modal1Y").textContent = (profile.changes > 0 ? "+" : "") + profile.changes.toFixed(2) + "% (Day)";
        document.getElementById("modal3Y").textContent = "Market: " + profile.exchangeShortName;
        
        // ë©”ì¸ ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ë™ê¸°í™”
        currentEtfs[idx].yield = parseFloat(realYield);
        document.getElementById(`yield-display-${idx}`).textContent = realYield + "%";
        
        statusText.textContent = "Live Sync Done";
        statusText.className = "text-xs font-bold text-emerald-500 mt-1 uppercase";
      } else {
        throw new Error("No Data");
      }
    } catch (error) {
      statusText.textContent = "Simulation Mode (API Limit)";
      statusText.className = "text-xs font-bold text-amber-500 mt-1 uppercase";
      
      const mock1Y = (Math.random() * (12 - 4) + 4).toFixed(2);
      const mock3Y = (Math.random() * (35 - 15) + 15).toFixed(2);
      document.getElementById("modal1Y").textContent = `â‰ˆ +${mock1Y}% (Est.)`;
      document.getElementById("modal3Y").textContent = `â‰ˆ +${mock3Y}% (Est.)`;
    }
    simulatePortfolio();
  }

  // â˜… ëª¨ë‹¬ ë‹«ê¸° (ìƒˆë¡œ ì¶”ê°€ëœ í•µì‹¬ í•¨ìˆ˜)
  function closeModal() {
    const modal = document.getElementById("detailModal");
    const content = document.getElementById("modalContent");
    content.classList.remove("scale-100", "opacity-100");
    content.classList.add("scale-95", "opacity-0");
    setTimeout(() => {
      modal.classList.add("hidden");
      document.body.style.overflow = "auto";
    }, 200);
  }

  function renderChart() {
    const ctx = document.getElementById('portfolioChart').getContext('2d');
    if(chartInstance) chartInstance.destroy();
    chartInstance = new Chart(ctx, {
      type: 'doughnut',
      data: { labels: currentEtfs.map(e => e.symbol), datasets:[{ data: currentEtfs.map(e => e.weight), backgroundColor: chartColors, borderWidth: 0 }] },
      options: { cutout: '75%', plugins: { legend: { display: false } }, animation: { duration: 400 } }
    });
  }

  function simulatePortfolio() {
    const rawVal = document.getElementById("totalInvestment").value.replace(/,/g, "");
    const total = parseFloat(rawVal) || 0;
    let mUSD = 0; let totalYield = 0;
    currentEtfs.forEach(e => {
      mUSD += (total * (e.weight / 100)) * (e.yield / 100) / 12;
      totalYield += (e.yield * (e.weight / 100));
    });
    document.getElementById("valUSD").textContent = `$${mUSD.toLocaleString(undefined, {minimumFractionDigits:2})}`;
    document.getElementById("valKRW").textContent = `â‚©${Math.floor(mUSD * currentExchangeRate).toLocaleString()}`;
    const badge = document.getElementById("annualYieldBadge");
    if(total > 0) {
      badge.classList.remove("hidden");
      document.getElementById("annualYieldValue").textContent = totalYield.toFixed(2);
    } else { badge.classList.add("hidden"); }
  }

  function handleCurrencyInput(el, type) {
    let val = el.value.replace(/,/g, "");
    if(!val) { 
      document.getElementById("totalInvestment").value = "";
      document.getElementById("totalInvestmentKRW").value = "";
      simulatePortfolio(); 
      return; 
    }
    el.value = Number(val).toLocaleString();
    if(type === 'KRW') {
      document.getElementById("totalInvestment").value = Number((val / currentExchangeRate).toFixed(2)).toLocaleString(undefined, {minimumFractionDigits:2});
    } else {
      document.getElementById("totalInvestmentKRW").value = Math.floor(val * currentExchangeRate).toLocaleString();
    }
    simulatePortfolio();
  }

  (async function init() {
    try {
      const res = await fetch('https://open.er-api.com/v6/latest/USD');
      const data = await res.json();
      if(data.rates.KRW) currentExchangeRate = data.rates.KRW;
    } catch(e) {}
    document.querySelectorAll('[data-i18n]').forEach(t => { t.innerHTML = translations[currentLang][t.getAttribute('data-i18n')]; });
    document.getElementById('langBtn').textContent = translations[currentLang].lang;
  })();
</script>
</body>
</html>
